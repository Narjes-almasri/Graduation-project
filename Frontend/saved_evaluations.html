<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Saved Evaluations</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;background:#f7f9fb;min-height:100vh;color:#0a1929}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    h1{font-size:28px;font-weight:900;margin-bottom:16px;background:linear-gradient(135deg,#154552,#357a8e);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:22px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:18px;cursor:pointer;transition:all .25s;position:relative;overflow:hidden;display:flex;flex-direction:column;gap:12px}
    .card:hover{transform:translateY(-6px);box-shadow:0 16px 36px rgba(0,0,0,.16);border-color:#357a8e}
    .thumb{width:100%;height:140px;border-radius:12px;background:#f0f4f8;background-size:cover;background-position:center;background-repeat:no-repeat;margin-bottom:12px;position:relative}
    .thumb::after{content:'';position:absolute;inset:0;border-radius:12px;box-shadow:inset 0 0 0 2px rgba(255,255,255,0.65)}
    .name{font-weight:900;font-size:16px;color:#0a1929;margin-bottom:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:1.4}
    .meta{font-size:12px;color:#64748b;display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:2px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-weight:800;font-size:11px}
    .chip.admin{background:linear-gradient(135deg,#154552,#357a8e);color:#fff;box-shadow:0 6px 16px rgba(21,69,82,0.25)}
    .chip.user{background:rgba(10,25,41,0.06);color:#0a1929;border:1px solid rgba(10,25,41,0.08)}
    .stats{display:flex;gap:10px;margin-top:10px;color:#0a1929;font-weight:700;font-size:12px}
    .stat-pill{padding:5px 12px;border-radius:999px;background:rgba(10,25,41,0.04);border:1px solid rgba(10,25,41,0.1)}
    .empty{padding:32px;text-align:center;color:#64748b;border:2px dashed #e5e7eb;border-radius:16px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;font-weight:700;cursor:pointer}
    .btn:hover{border-color:#357a8e}
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <h1>Saved Evaluations</h1>
      <button class="btn" onclick="window.location.href='profile.html'">Back to Profile</button>
    </div>
    <div id="list" class="grid"></div>
    <div id="empty" class="empty" style="display:none">No saved evaluations yet. Use Admin Evaluation in the builder.</div>
  </div>
  <script>
    (function(){
      let saved = [];
      try { saved = JSON.parse(localStorage.getItem('savedEvaluations') || '[]'); } catch(e) {}
      const list = document.getElementById('list');
      const empty = document.getElementById('empty');
      if (!saved.length){ empty.style.display='block'; return; }
      saved.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
      saved.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        card.title = item.name || 'Evaluation';
        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        if (item.logo) thumb.style.backgroundImage = `url(${item.logo})`;
        // Tint thumb/border with palette if available
        function getColors(p){
          if (!p) return null;
          if (Array.isArray(p)) return [p[0], p[1] || p[0]];
          if (Array.isArray(p.colors)) return [p.colors[0], p.colors[1] || p.colors[0]];
          const c1 = p.primary || p.color1; const c2 = p.secondary || p.color2 || c1; return c1 ? [c1,c2] : null;
        }
        const cols = getColors(item.palette);
        if (cols){
          thumb.style.boxShadow = `0 10px 26px rgba(0,0,0,0.18)`;
          card.style.borderColor = cols[0];
        }
        const name = document.createElement('div');
        name.className = 'name';
        name.textContent = item.name || 'Evaluation';
        const meta = document.createElement('div');
        meta.className = 'meta';
        const owner = document.createElement('span');
        owner.textContent = item.owner ? `Requested by ${item.owner}` : 'Requested';
        const isAdmin = !!item.request;
        const badge = document.createElement('span');
        badge.className = `chip ${isAdmin ? 'admin' : 'user'}`;
        badge.textContent = isAdmin ? 'Admin' : 'User';
        const date = document.createElement('span');
        try {
          const d = new Date(item.createdAt);
          date.textContent = d.toLocaleString();
        } catch(e) { date.textContent = item.createdAt || ''; }
        meta.appendChild(owner);
        meta.appendChild(badge);
        meta.appendChild(date);
        // Stats: criteria/grades count and status
        const stats = document.createElement('div');
        stats.className = 'stats';
        const gradeCount = (() => {
          if (Array.isArray(item.grades)) return item.grades.length;
          if (item.content && typeof item.content === 'object') return Object.keys(item.content).length;
          return 0;
        })();
        const criteria = document.createElement('span');
        criteria.className = 'stat-pill';
        criteria.textContent = `Criteria: ${gradeCount}`;
        const status = document.createElement('span');
        status.className = 'stat-pill';
        status.textContent = item.request?.status ? `Status: ${item.request.status.replace('_',' ')}` : 'Status: draft';
        stats.appendChild(criteria);
        stats.appendChild(status);
        card.appendChild(thumb);
        card.appendChild(name);
        card.appendChild(meta);
        card.appendChild(stats);
        card.addEventListener('click', function(){
          window.location.href = 'final_preview.html?evalId=' + encodeURIComponent(item.id);
        });
        list.appendChild(card);
      });
    })();
  </script>
</body>
</html>